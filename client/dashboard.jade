template(name='dashboard')
    #dash_header.ui.vertical.masthead.center.aligned.padded.segment
        .ui.container
            .ui.hidden.divider
            img.ui.medium.centered.image(src='https://jan-pro.com/wp-content/themes/underboot/img/jan-pro-white.svg')
            h2.ui.inverted.header Customer Portal
            unless currentUser
                a.ui.center.aligned.big.inverted.blue.button(href='/login')
                    |Login to see Dashboard
                    i.right.arrow.icon
        if currentUser
            +customer_menu
    if is_customer
        .ui.padded.stackable.grid
            if currentUser.users_customer.parent_franchisee.parent_office.customer_message
                .three.column.row
                    .column
                        .ui.info.icon.floating.message
                            i.info.icon
                            .content
                                .header #{currentUser.users_customer.parent_franchisee.parent_office.ev.MASTER_LICENSEE} Message
                                p #{currentUser.users_customer.parent_franchisee.parent_office.customer_message}
                    .column
                        .ui.info.icon.floating.message
                            i.bullhorn.icon
                            .content
                                .header #{currentUser.users_customer.parent_franchisee.parent_office.ev.MASTER_LICENSEE} Promotions
                                p #{currentUser.users_customer.parent_franchisee.parent_office.customer_promotions}
                    .column
                        +small_service_list

            .row
                with currentUser.users_customer.parent_franchisee
                    .sixteen.wide.column
                        .ui.secondary.segment
                            h3.ui.header 
                                +icon name='conference'
                                // |#{ev.FRANCHISEE} Franchisee Contact
                                |Your Local Owner / Operator
                            table.ui.sortable.striped.table
                                tbody
                                    tr
                                        td #{ev.FRANCHISEE}
                                        td(title='Short Name') #{ev.FRANCH_NAME}
                                        td #{ev.FRANCH_EMAIL}
                                        td #{ev.TELE_CELL} #{profile.phone}
                                        td
                                            a(href="mailto:#{ev.FRANCH_EMAIL}" target='_window' title="Email #{franchisee}")
                                                // i.mail.icon
                                                +icon name='send'
            .row
                .sixteen.wide.column
                    .ui.secondary.segment
                        +customer_incidents_widget
            .row
                .sixteen.wide.column
                    +dashboard_services_widget
            // .row
            //     .sixteen.wide.column
            //         +dashboard_consumables_widget
            .row
                .sixteen.wide.column
                    .ui.secondary.segment
                        +office_contact_cards
            .centered.row
                .eight.wide.column
                    .ui.secondary.segment
                        +dashboard_office_contacts_list
                .eight.wide.column
                    .ui.secondary.segment
                        +customer_special_services
            .centered.row
                .five.wide.column
                    +customer_finance_widget
            //     .five.wide.column
            //         +user_franchise_card
            //     .five.wide.column
            //         +user_office_card

    
template(name='customer_menu')
    .ui.five.item.stackable.large.menu
        a.item(href='/account/settings') 
            i.large.icon
                +icon name='settings'
            | &nbsp; Account
        a.log_ticket.item(href='#') 
            i.large.icon
                +icon name='add-ticket'
            | &nbsp; Log a Ticket
        a.item(href='/customer_incidents')
            i.large.icon
                +iconsmall name='error'
            | &nbsp; My Incidents
        a.item(href='/store') 
            i.large.icon
                +icon name='toilet-paper'
            | &nbsp; Consumables
        a.item(href='/services') 
            i.large.icon
                +icon name='service-bell'
            | &nbsp; Request Service
        // a.item(href='/help') 
        //     i.big.icon
        //         +icon name='help'
        //     | &nbsp; Help

template(name='dashboard_services_widget')
    .ui.secondary.segment
        .ui.header 
            +iconsmall name='broom'
            |Services Offered by #{currentUser.users_office.ev.MASTER_LICENSEE}
        .ui.centered.cards
            each services_offered
                +service_card     
                
template(name='dashboard_consumables_widget')
    .ui.secondary.segment
        .ui.header 
            +iconsmall name='toilet-paper'
            |Consumables
        .ui.cards
            each products_available
                +product_card     
                
template(name='my_cleaning_schedule')
    .ui.fluid.accordion
        .active.title
            h3.ui.header 
                |Cleaning Schedule
                i.dropdown.icon
        .active.content
            #cleaning_schedule
                +fullcalendar cal_options
            
        
template(name='office_contact_cards')
    h3.ui.header 
        +icon name='contacts'
        // i.big.icons
        //     i.users.icon
        //     i.corner.building.icon
        |Office Contacts
    .ui.stackable.centered.six.cards
        each office_contacts
            +office_contact_card

template(name='office_contact_card')
    .ui.card
        .image
            a(href="/user/#{username}")
                img.ui.fluid.image(src="{{c.url profile.image_id height=200 width=200 crop='fill' gravity='face'}}")
        .content
            a(href="/user/#{username}")
                .ui.header #{profile.first_name} #{profile.last_name}
                .meta #{username}
        .content
            .ui.small.list
                a.item(href="mailto:#{email}" target='_window' title="Email #{name}")
                    |#{email}
                .item #{ev.JOB_TITLE}
                .item #{ev.TELE_CELL} #{profile.phone}
                
        // +view_button


template(name='customer_incidents_widget')
    h3.ui.header
        // i.exclamation.circle.icon
        +icon name='error'
        | #{currentUser.users_customer.ev.CUST_NAME}'s Incidents
    table.ui.striped.table
        thead
            tr
                th Number
                th Type
                th Details
                th Level
                th Status
                th Submitted
                th Assigned To
                th Last Event
                th
        tbody
            each customer_incidents
                tr
                    td #{incident_number}
                    td
                        +incident_type_label
                    td #{incident_details}
                    td #{level}
                    td 
                        +status_template
                    td
                        +submitted_template
                    td
                        +associated_users
                    td
                        +small_doc_history
                    td
                        +view_button


template(name='customer_special_services')
    h3.ui.header 
        // i.paint.brush.icon
        +icon name='broom'
        |Services Overview
    with currentUser.users_customer
        .ui.horizontal.divided.list
            // .item #{customer_contact_person}
            if customer_contact_email
                .item #{customer_contact_email}
            .item Number of Days of Service: #{ev.CUST_NUM_DAYS_SERVICE}
            .item Days of Service: #{customer_days_service_formatted}
            .item Regular Service Amount: $#{ev.CUST_REG_SERVICE_AMT}
    .ui.header Special Services
    table.ui.sortable.striped.table
        thead
            tr
                // th JPID
                // th Customer
                th Service Type
                th Description
                th Date Created
                th Extra Price
                
        tbody
            each my_special_services
                tr
                    // td #{ev.ID}
                    // td #{ev.CUSTOMER}
                    td #{ev.SERV_TYPE}
                    td #{ev.EXTRA_SERV_DESC}
                    td #{ev.DATE_CREATED}
                    td #{ev.EXTRA_PRICE}



template(name='dashboard_office_contacts_list')
    h3.ui.header 
        +icon name='organization'
        |#{currentUser.users_customer.parent_franchisee.parent_office.ev.MASTER_LICENSEE} Contacts

    table.ui.sortable.striped.table
        tbody
            each office_contacts
                tr
                    td 
                        img.ui.avatar.image(src="{{c.url profile.image_id height=200 width=200 crop='fill' gravity='face'}}")
                        |#{profile.first_name} #{profile.last_name}
                    td #{profile.title}
                    td 
                        div #{ev.JOB_TITLE}
                        div #{ev.WORK_TELEPHONE} #{ev.TELE_CELL} #{profile.phone}
                        div #{email}
                    td
                        a(href="mailto:#{email}" target='_window' title="Email #{name}")
                            // i.mail.icon
                            +icon name='send'
                    // td 
                    //     +view_user_button

template(name='small_service_list')
    .ui.secondary.segment
        .ui.header 
            +iconsmall name='broom'
            |Services Offered
        .ui.list
            each services_offered
                a.item(href="/view/#{_id}")
                    img.ui.avatar.image(src="{{c.url image_id height=400 crop='scale'}}")
                    |#{title}


template(name='customer_finance_widget')
    .ui.secondary.segment
        .ui.header 
            +iconsmall name='money'
            |Finances
        .ui.header Account Status
        .ui.header Invoices
        .ui.header Statements
        .ui.header Work History
        
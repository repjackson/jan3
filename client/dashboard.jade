template(name='dashboard')
    #dash_header.ui.vertical.masthead.center.aligned.padded.segment
        .ui.container
            .ui.hidden.divider
            img.ui.medium.centered.image(src='https://jan-pro.com/wp-content/themes/underboot/img/jan-pro-white.svg')
            h2.ui.inverted.header Customer Portal
            unless currentUser
                a.ui.center.aligned.big.inverted.blue.button(href='/login')
                    |Login to see Dashboard
                    i.right.arrow.icon
        if is_customer
            +customer_menu
    if is_customer
        .ui.padded.stackable.grid
            if currentUser.users_customer.parent_franchisee.parent_office.customer_message
                .four.column.row
                    .column
                        .ui.floating.message
                            .content
                                .header 
                                    i.large.icon
                                        +icon name='sms'
                                    |#{currentUser.users_customer.parent_franchisee.parent_office.ev.MASTER_LICENSEE} Message
                            .content
                                p 
                                p #{currentUser.users_customer.parent_franchisee.parent_office.customer_message}
                    .column
                        .ui.floating.message
                            .content
                                .header 
                                    i.large.icon
                                        +icon name='discount'
                                    |#{currentUser.users_customer.parent_franchisee.parent_office.ev.MASTER_LICENSEE} Promotions
                            .content
                                p 
                                p #{currentUser.users_customer.parent_franchisee.parent_office.customer_promotions}
                    .column
                        .ui.floating.message
                            .content
                                .header 
                                    i.large.icon
                                        +icon name='faq'
                                    |#{currentUser.users_customer.parent_franchisee.parent_office.ev.MASTER_LICENSEE} Help Policy
                            .content
                                p 
                                p #{currentUser.users_customer.parent_franchisee.parent_office.help_policy}
                    .column
                        +small_service_list

            .row
                with currentUser.users_customer.parent_franchisee
                    .sixteen.wide.column
                        .ui.secondary.segment
                            h3.ui.header 
                                +icon name='conference'
                                // |#{ev.FRANCHISEE} Franchisee Contact
                                |Your Local Owner / Operator
                            table.ui.sortable.striped.table
                                tbody
                                    tr
                                        td #{ev.FRANCHISEE}
                                        td(title='Short Name') #{ev.FRANCH_NAME}
                                        td #{ev.FRANCH_EMAIL}
                                        td #{ev.TELE_CELL} #{profile.phone}
                                        td
                                            a(href="mailto:#{ev.FRANCH_EMAIL}" target='_window' title="Email #{franchisee}")
                                                // i.mail.icon
                                                +icon name='send'
            .row
                .sixteen.wide.column
                    .ui.secondary.segment
                        +customer_incidents_widget
                        +modules tags='customer,dashboard,incidents'
            .row
                .sixteen.wide.column
                    .ui.secondary.fluid.segment
                        +modules tags='customer,dashboard,invoices'
            .centered.row
                .sixteen.wide.column
                    .ui.secondary.segment
                        +dashboard_office_contacts_list
                        +modules tags='customer,dashboard,office,contacts'
            .centered.row
                .sixteen.wide.column
                    .ui.secondary.segment
                        +customer_special_services
            //     .five.wide.column
            //         +user_franchise_card
            //     .five.wide.column
            //         +user_office_card

    
template(name='customer_menu')
    .ui.five.item.stackable.large.menu
        a.item(href='/account/settings') 
            i.large.icon
                +icon name='settings'
            | &nbsp; Account
        a.log_ticket.item(href='#') 
            i.large.icon
                +icon name='add-ticket'
            | &nbsp; Log a Ticket
        a.item(href='/customer_incidents')
            i.large.icon
                +iconsmall name='error'
            | &nbsp; My Incidents
        a.item(href='/services') 
            i.large.icon
                +icon name='service-bell'
            | &nbsp; Request Service
        // a.item(href='/help') 
        //     i.big.icon
        //         +icon name='help'
        //     | &nbsp; Help

template(name='dashboard_services_widget')
    .ui.secondary.segment
        .ui.header 
            +iconsmall name='broom'
            |Services Offered by #{currentUser.users_office.ev.MASTER_LICENSEE}
        .ui.three.cards
            each services_offered
                +service_card     
                
template(name='dashboard_consumables_widget')
    .ui.secondary.segment
        .ui.header 
            +iconsmall name='toilet-paper'
            |Consumables
        .ui.cards
            each products_available
                +product_card     
                
// template(name='my_cleaning_schedule')
//     .ui.fluid.accordion
//         .active.title
//             h3.ui.header 
//                 |Cleaning Schedule
//                 i.dropdown.icon
//         .active.content
//             #cleaning_schedule
//                 +fullcalendar cal_options
            
        
// template(name='office_contact_cards')
//     h3.ui.header 
//         +icon name='contacts'
//         // i.big.icons
//         //     i.users.icon
//         //     i.corner.building.icon
//         |Office Contacts
//     .ui.stackable.centered.seven.cards
//         each office_contacts
//             +office_contact_card

// template(name='office_contact_card')
//     .ui.card
//         .image
//             a(href="/user/#{username}")
//                 img.ui.image(src="{{c.url profile.image_id height=200 width=200 crop='fill' gravity='face'}}")
//         .content
//             a(href="/user/#{username}")
//                 .ui.header #{profile.first_name} #{profile.last_name}
//                 .meta #{username}
//         .content
//             .ui.small.list
//                 a.item(href="mailto:#{email}" target='_window' title="Email #{name}")
//                     |#{email}
//                 .item #{ev.JOB_TITLE}
//                 .item #{ev.TELE_CELL} #{profile.phone}
                
        // +view_button


template(name='customer_incidents_widget')
    h3.ui.header
        // i.exclamation.circle.icon
        +icon name='error'
        | #{currentUser.users_customer.ev.CUST_NAME}'s Incidents
    table.ui.striped.fixed.table
        thead
            tr
                th.one.wide #
                th Type
                th Details
                th Service Date
                th Status
                th Submitted
                th Assigned To
                // th.four.wide Last Event
                th.one.wide View 
        tbody
            each customer_incidents
                tr
                    td #{incident_number}
                    td
                        +incident_type_label
                    td #{incident_details}
                    td #{service_date}
                    td 
                        +status_template
                    td
                        +submitted_template
                    td
                        +associated_users
                    // td
                    //     +small_doc_history
                    td
                        +view_button
        tfoot
            tr
                th(colspan='8')
                    if pages
                        .ui.right.floated
                        .ui.right.floated.pagination.menu
                            each pages
                                a.set_page_number.item(class=pagination_item_class) #{number}
                    |#{skip_amount}-#{end_result} of #{count_amount}

template(name='customer_special_services')
    h3.ui.header 
        // i.paint.brush.icon
        +icon name='broom'
        |Special Services
    with currentUser.users_customer
        .ui.horizontal.divided.list
            // .item #{customer_contact_person}
            if customer_contact_email
                .item #{customer_contact_email}
            .item Number of Days of Service: #{ev.CUST_NUM_DAYS_SERVICE}
            .item Days of Service: #{customer_days_service_formatted}
            .item Regular Service Amount: $#{ev.CUST_REG_SERVICE_AMT}
    +modules tags='customer,dashboard,special_services'
    

template(name='dashboard_office_contacts_list')
    h3.ui.header 
        +icon name='organization'
        |#{currentUser.users_customer.parent_franchisee.parent_office.ev.MASTER_LICENSEE} Contacts

    table.ui.sortable.striped.table
        tbody
            each office_contacts
                tr
                    td 
                        img.ui.avatar.image(src="{{c.url profile.image_id height=200 width=200 crop='fill' gravity='face'}}")
                        .ui.popup
                            img.ui.small.image(src="{{c.url profile.image_id height=500 width=500 crop='fill' gravity='face'}}")
                        a(href="/user/#{username}") #{profile.first_name} #{profile.last_name}
                        .ui.popup
                            img.ui.small.image(src="{{c.url profile.image_id height=500 width=500 crop='fill' gravity='face'}}")
                    td 
                        div #{profile.title}
                        div 
                            strong #{profile.function}
                    td 
                        div #{ev.JOB_TITLE}
                        div #{ev.WORK_TELEPHONE} #{ev.TELE_CELL} #{profile.phone}
                        div #{email}
                    td
                        a(href="mailto:#{email}" target='_window' title="Email #{name}")
                            // i.mail.icon
                            +icon name='send'
                    // td 
                    //     +view_user_button

template(name='small_service_list')
    .ui.secondary.segment
        h4.ui.dividing.header 
            +iconsmall name='broom'
            |Other Jan-Pro Services Offered
        .ui.three.column.grid
            each services_offered
                .column
                    a.ui.item(href="/v/#{_id}")
                        img.ui.avatar.image(src="{{c.url image_id height=400 crop='scale'}}")
                        |#{title}


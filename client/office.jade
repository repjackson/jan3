template(name='office_dashboard')
    .ui.padded.stackable.grid
        .row
            with office_doc
                .four.wide.column
                    .ui.secondary.segment
                        .ui.list
                            .item ##{ev.ID}
                            // .item Office Name
                            //     strong #{ev.MASTER_LICENSEE}
                            .item Owner
                                strong #{ev.MASTER_OFFICE_OWNER}
                            .item Manager
                                strong #{ev.MASTER_OFFICE_MANAGER}
                            // .item Last Updated
                            //     strong #{ev.TIMESTAMP}
                            .item #{ev.TELEPHONE}
                            .item 
                                |#{ev.ADDR_STREET} #{ev.ADDR_STREET_2} #{ev.ADDR_CITY} #{ev.ADDR_STATE} #{ev.ADDR_POSTAL_CODE} #{ev.MASTER_COUNTRY}
                                a(href=office_map_address target='_blank')
                                    i.external.icon
                    +blocks tags='office,dashboard,finance'
                    +blocks tags='office,dashboard,service_requests'
                    .ui.secondary.segment
                        .ui.header
                            +icon name='bar-chart'
                            |Stats
                        .ui.list
                            .item Incidents
                                +view_stat doc_type='incident' stat_type='office_incidents' 
                            .item Franchisees
                                +view_stat doc_type='franchisee' stat_type='office_franchisees' 
                            .item Customers
                                +view_stat doc_type='customer' stat_type='office_customers' 
                            .item Employees
                                +view_stat stat_type='office_employees' 
                .eight.wide.column
                    +blocks tags='office,dashboard,feed'
                    +blocks tags='office,dashboard,incidents'
                    +blocks tags='office,dashboard,incident_feedback'
                .four.wide.column
                    +blocks tags='office,dashboard,messages'
                    +blocks tags='office,dashboard,comments'




template(name='office_messages')
    .ui.stackable.padded.grid
        .sixteen.wide.column
            .row.ui.secondary.segment
                .ui.grid
                    .five.wide.column
                        +edit_textarea key='customer_message' label='Customer Dashboard Message' icon='dashboard'
                        // +edit_text_field key='customer_special_services' label='Customer Dashboard Special Services'
                    .five.wide.column
                        +edit_textarea key='customer_promotions' label='Customer Dashboard Promotions Message' icon='megaphone'
                    .five.wide.column
                        +edit_textarea key='help_policy' label='Customer Dashboard Help Policy' icon='info'
                        
                        
template(name='office_sla')
    each incident_types
        .select_incident_type.ui.button(class=select_incident_type_button_class) 
            if icon
                i.icon  
                    +icon name=icon
            |#{title}
    if selected_incident_type
        table.ui.celled.table
            thead
                tr  
                    th Level
                    th Escalation Hours
                    th Contact Customer
                    th Contact Franchisee
                    th Owner
                    th Email Owner
                    th SMS Owner
                    th Secondary Contact
                    th Email Secondary
                    th SMS Secondary
            tbody
                each rule_docs
                    tr  
                        td #{title}
                        if sla_settings_doc
                            with sla_settings_doc
                                if is_initial
                                    td
                                    td
                                        +toggle_sla_boolean key='contact_customer' label='Customer' icon='headset'
                                else 
                                    td 
                                        // +edit_number_field key=hours_key label='Escalation Hours' field_class='inline' min=0 max=24
                                        +set_sla_key_value key=hours_key value=1 label='1'
                                        +set_sla_key_value key=hours_key value=2 label='2'
                                        +set_sla_key_value key=hours_key value=4 label='4'
                                        +set_sla_key_value key=hours_key value=12 label='12'
                                    td
                                td
                                    +toggle_sla_boolean key='contact_franchisee' label='Franchisee' icon='business'
                                if is_initial
                                    td
                                        +incident_owner_select
                                    td
                                        +toggle_sla_boolean key='email_owner' label='Email' icon='envelope'
                                    td
                                        +toggle_sla_boolean key='sms_owner' label='SMS' icon='comment'
                                else
                                    td Owner
                                        if incident_owner
                                            .ui.large.basic.label #{incident_owner}
                                    td
                                    td
                                td Secondary
                                    +secondary_contact_widget
                                td
                                    +toggle_sla_boolean key='email_secondary' label='Email' icon='envelope'
                                td
                                    +toggle_sla_boolean key='sms_secondary' label='SMS' icon='comment'
                        else
                            td No settings file
                                .add_sla_setting_doc.ui.button Create


template(name='office_service_settings')
    // h5.ui.header Select which to offer customers.
    each services
        if title
            .select_service.ui.button(class=select_service_button_class) 
                // if icon
                //     +icon name=icon classes='ui spaced image'
                |#{title}
            
            
            
template(name='set_sla_key_value')
    .set_page_key_value.ui.compact.button(class=set_value_button_class) 
        |#{label}
        
        
template(name='incident_owner_select')
    unless incident_owner
        .ui.form
            .field
                .ui.icon.input
                    i.search.icon
                    input#query_owner(type='text' placeholder='Select Owner...')
            if user_results
                .ui.secondary.segment
                    .ui.middle.aligned.selection.animated.list
                        each user_results
                            .select_owner.basic.large.label.item 
                                if profile.image_id
                                    img.ui.avatar.image(src="{{c.url profile.image_id width=100 height=100 gravity='face' crop='fill'}}")
                                strong #{profile.first_name} #{profile.last_name}
                                |#{username}
    if incident_owner
        .ui.header #{incident_owner}
        |&nbsp;
        .ui.icon.compact.small.button.pull_user
            i.remove.icon


// template(name='view_sla_contact')
//     // .ui.header SLA Contact #{key}
//     with selected_contact
//         .ui.header
//             |#{profile.first_name} #{profile.last_name}
//         .description
//             | @#{username}
//             div #{ev.EMAIL}

template(name='secondary_contact_widget')
    unless secondary_contact
        // h5.ui.header 
        //     i.user.grey.icon
        //     |#{label}
        .ui.form
            .field
                .ui.icon.input
                    i.search.icon
                    input#secondary_input(type='text' placeholder=label)
            if user_results
                .ui.secondary.segment
                    .ui.middle.aligned.selection.animated.list
                        each user_results
                            .select_secondary.basic.large.label.item 
                                if profile.image_id
                                    img.ui.avatar.image(src="{{c.url profile.image_id width=100 height=100 gravity='face' crop='fill'}}")
                                strong #{profile.first_name} #{profile.last_name}
                                |#{username}
    if secondary_contact
        .ui.header #{secondary_contact}
        // div(title="@#{username}")
        //     if profile.image_id
        //         img.ui.avatar.image(src="{{c.url profile.image_id width=100 height=100 gravity='face' crop='fill'}}")
        //     |#{profile.first_name} #{profile.last_name}
        .ui.icon.compact.button.pull_secondary
            i.remove.icon

template(name='incidents')
    .ui.stackable.padded.centered.grid
        .middle.aligned.centered.row
            .three.wide.column
                +add_button type='incident' label='Incident'
            .ten.wide.column
                h2.ui.center.aligned.header 
                    i.exclamation.circle.icon
                    | Incidents
            .three.wide.column
        .row
            .sixteen.wide.column
                {{> tabular table=TabularTables.Incidents selector=selector class="ui sortable selectable striped fluid table"}}


template(name='incident_item')
    .ui.item
        if image_id
            a.image(href="/view/#{_id}")
                img.ui.rounded.image(src="{{c.url image_id  width=175 height=175 crop='fill' gravity='face' }}")
                // each visual
                //     .ui.basic.small.label #{class}
        .content
            a.grey.header(href="/view/#{_id}") 
                |##{incident_number}
            .description
                .ui.stackable.grid
                    .twelve.wide.column
                        .large130 {{nl2br incident_details}}
                        .ui.hidden.divider
                        +tone
                        .meta 
                            |Keywords: 
                            |&nbsp;
                            each watson_keywords
                                .ui.basic.label #{this}
                    .four.wide.column
                        +view_button
                        .meta #{when}
                        .meta #{formal_when}
                        // .ui.horizontal.list
                        //     each date_array
                        //         .item #{this}
                        if office.office_name
                            .ui.basic.label #{office.office_name}
                        +incident_type_label
                        if current_level
                            .ui.basic.label Level #{current_level}
                        +author_info
                        if comment_count
                            a.meta(href="/view/#{_id}")
                                i.comments.icon
                                |#{comment_count} comments
                        if watson
                            +doc_sentiment
                            +doc_emotion
                        // each tone.document_tone.tones
                        //     h4.ui.header #{tone_id} {{ to_percent score }}%
        

                
template(name='incident_edit')
    .ui.padded.stackable.centered.grid
        .centered.middle.aligned.row
            .three.wide.center.aligned.column
                #delete.ui.icon.button
                    i.trash.icon
            .ten.wide.column
                h1.ui.center.aligned.grey.header Edit Incident ##{incident_number}
            .three.wide.column
                +save_button
        .row
            .four.wide.column
                // if is_dev
                //     +edit_author
                .ui.large.form
                    +edit_number_field key='incident_number' label='Number' icon='hashtag'
                    +edit_date_field key='service_date' label='Service Date' icon='calendar'
                .ui.secondary.segment
                    h4 Priority
                    +toggle_key key='priority' value='low' label='Low'
                    +toggle_key key='priority' value='medium' label='Medium'
                    +toggle_key key='priority' value='high' label='High'
                    +toggle_key key='priority' value='emergency' label='Emergency'
                +multiple_user_select key='assigned_to' label='Assigned To' icon='users'
            .twelve.wide.column
                .ui.secondary.segment
                    .ui.header Type
                    each incident_type_docs
                        +toggle_key key='incident_type' value=slug label=name
    
                // +edit_html_field
                +edit_textarea label='Incident Details' key='incident_details'
                +edit_image_field
                // +edit_textarea key='incident_details' label='Details'

        
template(name='incident_view')
    .ui.padded.stackable.grid
        .middle.aligned.row
            .three.wide.center.aligned.column
                +link_button link='/incidents' label='incidents' icon='exclamation circle'
            .ten.wide.column
                h1.ui.center.aligned.header Incident ##{incident_number}
            .three.wide.center.aligned.column
                +edit_button
        .row
            .four.wide.column
                div
                    |Logged by
                    +author_info
                    |#{when}
                +incident_type_label
                h4.ui.header Service Date: #{service_date}
                +incident_status
            .eight.wide.column
                .ui.basic.segment
                    .large130 {{nl2br incident_details}}
                if image_id
                    img.ui.centered.image(src="{{c.url image_id height=500 crop='fit'}}")
                +comments
                .ui.dividing.header Incident History
                +full_doc_history
            .four.wide.column
                with author
                    +user_card
                with office
                    +office_card
                +incident_tasks

                            
template(name='incident_level_set')
    .set_level.ui.compact.button(title='Set Level')
        // i.checkmark.icon
        |#{level}
                        
                        
template(name='incident_type_label')      
    if incident_type_label
        .ui.basic.label(class=type_label_class) #{incident_type_label}


template(name='incident_status')
    .ui.dividing.header 
        i.tasks.icon
        |Level: #{current_level}
    +incident_level_set level=1
    +incident_level_set level=2
    +incident_level_set level=3
    +incident_level_set level=4


template(name='incident_tasks')
    .ui.dividing.header 
        |Incident Tasks
    #add_incident_task.ui.small.icon.button(title='Add Task')
        i.plus.icon
    .ui.list
        each incident_tasks
            .item
                .content
                    a.header(href="/view/#{_id}") 
                        if complete
                            i.green.checkmark.icon
                        |#{title}
                    
                    

template(name='incident_task_edit')
    .ui.padded.stackable.centered.grid
        .centered.row
            .three.wide.center.aligned.column
                +save_button
            .ten.wide.center.aligned.column
                h1.ui.center.aligned.grey.header Edit Incident Task
            .three.wide.center.aligned.column
                #delete.ui.icon.button
                    i.trash.icon
        .centered.row
            .twelve.wide.column
                +edit_text_field key='title' label='Title' 
                .ui.hidden.divider
                +edit_html
            .four.wide.column
                +edit_date_field label='Due Date' key='due_date'
                // +edit_array_field key='tags' label='Tags'
                +multiple_user_select
                .ui.secondary.segment
                    .ui.header Action Type
                    each action_docs
                        +toggle_key key='task_type' value=slug label=title
    
template(name='incident_task_view')
    .ui.padded.stackable.centered.grid
        .centered.row
            .three.wide.center.aligned.column
                +parent_link
            .ten.wide.center.aligned.column
                h1.ui.center.aligned.grey.header View Incident Task
            .three.wide.center.aligned.column
                +edit_button
        .row
            .four.wide.column
                +author_info
                .ui.hidden.divider
                if complete
                    #turn_off.ui.icon.button
                        i.large.toggle.on.green.icon
                    .ui.header Complete
                else
                    #turn_on.ui.icon.button
                        i.large.toggle.off.icon
                    .ui.header Incomplete
            .eight.wide.column
                +parent_segment
                .ui.header #{title}
                |!{html}
                +comments
                +full_doc_history
            .four.wide.column
                 +mark_read_button   
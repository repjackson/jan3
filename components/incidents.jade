template(name='incidents')
    .ui.stackable.padded.centered.grid
        .centered.row
            .three.wide.column
            .ten.wide.column
                h1.ui.center.aligned.header 
                    i.edit.icon
                    |Incidents
            .three.wide.column
        .centered.row
            .three.wide.column
                +add_button type='incident' label='Incident'
                .ui.dividing.header
                    i.filter.icon
                    |Filters
                .ui.dividing.header Type
                .ui.dividing.header Status
                .ui.dividing.header Office
            .thirteen.wide.column
                .ui.centered.stackable.cards
                    each incidents
                        +incident_card


template(name='my_incidents')
    .ui.fluid.card
        .content
            .ui.header My Docs
            .ui.cards
                each my_incidents
                    .item 
                        a(href="/view/#{_id}") #{title}


template(name='incident')
    .ui.card
        .ui.centered.image
            a(href="/view/#{_id}")
                img(src="{{c.url image_id  height=300 crop='fill' gravity='face' }}")
        .content
            h1.ui.header
                a(href="/view/#{_id}") #{title}
            if publish_date
                .meta
                    | Published #{publish_when}
            .description
                |{{nl2br body}}
        .content
            each tags
                .ui.compact.button.incident_tag(class=tag_class) #{this}
            .incident_edit.ui.primary.basic.right.floated.button
                i.pencil.icon
                |Edit Incident    
            
            
template(name='incident_item')
    .ui.item
        a.image(href="/view/#{_id}")
            img.ui.rounded.image(src="{{c.url image_id  width=175 height=175 crop='fill' gravity='face' }}")
        .content
            a.header(href="/view/#{_id}") #{title}
            .meta Created by #{createdBy}
            .meta Type #{type}
            .meta Number #{number}
            .description
                .ui.header Body
                |!{body}
            a.ui.button(href="/view/#{_id}") 
                |View
                i.chevron.right.icon
                
template(name='incident_card')
    .ui.card
        a.image(href="/view/#{_id}")
            img.ui.rounded.image(src="{{c.url image_id  width=175 height=175 crop='fill' }}")
        .content
            .right.floated.meta
                .ui.circular.label(title='Incident Number') #{incident_number}
            a.header(href="/view/#{_id}") Incident #{incident_number}
        .content    
            .right.floated Logged #{when}
            | Created by #{author.username}
        .content    
            .description
                |#{incident_details}
        .content
            .right.floated
                +incident_type_label
            i.comment.icon
            | 4 Comments
        // .content
        //     // +view_full_button
        //     a.ui.button(href="/view/#{_id}") 
        //         |View
        //         i.chevron.right.icon
                
                
template(name='incident_edit')
    h1.ui.center.aligned.header Edit Incident #{incident_number}
    .ui.padded.stackable.centered.grid
        .eight.wide.column
            .ui.large.form
                // +edit_text_field key='title' label='Title'  
                +edit_image_field
                +edit_textarea key='incident_details' label='Details'
                .field
                    label Type
                    +toggle_key key='incident_type' value='missed_service' label='Missed Service'
                    +toggle_key key='incident_type' value='poor_service' label='Poor Service'
                    +toggle_key key='incident_type' value='employee_issue' label='Employee Issue'
                    +toggle_key key='incident_type' value='other' label='Other'
                
        .four.wide.column
            .ui.large.form
                +reference_single_doc key='jan_office_id' label='Jan Office' type='office'

                +edit_text_field key='jan_office_id' label='Jan Pro Office ID' icon='building'
                +edit_text_field key='customer_id' label='Customer ID' icon='user'
                +edit_number_field key='incident_number' label='Number' icon='hashtag'
                +edit_date_field key='incident_date' label='Date' icon='calendar'
            .ui.hidden.divider
            a.ui.fluid.basic.big.button(href="/view/#{_id}") 
                i.save.icon
                strong Save
            .ui.hidden.divider
            #delete.ui.basic.fluid.button
                i.trash.icon
                | Delete
        
        
template(name='incident_view')
    .ui.padded.stackable.centered.grid
        .centered.row
            .three.wide.column
                a.ui.top.left.attached.button(href="/incidents")
                    i.chevron.left.icon
                    |Incidents
            .ten.wide.column
                h1.ui.center.aligned.header Incident #{incident_number}
            .three.wide.column
        .row
            .eight.wide.column
                if image_id
                    img.ui.centered.image(src="{{c.url image_id height=500 crop='fit'}}")
                .ui.dividing.header 
                    i.align.left.icon
                    |Details
                .ui.basic.segment
                    strong #{incident_details}
                +comments
            .four.wide.column
                .ui.large.relaxed.list
                    +list_item key='customer_id' label='Customer ID' icon='user'
                    +list_item icon='hashtag' label='Number' key='incident_number'
                    +list_item icon='calendar' label='Date' key='incident_date'
                    +list_item icon='building' label='Jan-Pro Office Id' key='jan_office_id'
                    +list_item icon='file.image' label='Associated Documents'
                .ui.header
                    | Logged
                    +author_info
                .ui.header #{formal_when}
                .ui.header
                    +incident_type_label
                .ui.hidden.divider
                +edit_button
        .row
            .twelve.wide.column
                .ui.fluid.steps
                    .active.step
                        i.edit.icon
                        .content
                            .title Process
                            .description Fill in required fields to submit for processing
                    .step
                        i.circle.outline.icon
                        .content
                            .title Level 2
                            .description
                    .disabled.step
                        i.dot.circle.outline.icon
                        .content
                            .title Level 3
                    .disabled.step
                        i.checkmark.icon
                        .content
                            .title Satisfaction Survey
                        
template(name='incident_type_label')                    
    .ui.label(class=type_label_class) #{incident_type_label}
